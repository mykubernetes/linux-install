# MySQL

## 课程大纲

第一章 数据库的介绍
第二章 MySQL介绍和安装
第三章 MySQL体系结构和基础管理
第四章 MySQL的SQL基础
第五章 MySQL索引和执行计划
第六章 MySQL存储引擎
第七章 MySQL日志管理
第八章 MySQL备份恢复
第九章 MySQL复制技术
第十章 MySQL高可用和读写分离
第十一章 MySQL优化
第十二章 NoSQL

### 1.介绍

1. 什么是数据库? 
业务中,敏感,安全和一致性要求高的.统一存储至数据库

2. 数据库种类

  ```
     RDBMS : Oracle MySQL  PG  MSSQL 
     NoSQL : MongoDB Redis ES
     NewSQL: TiDB PolarXDB TDSQL
  
  https://db-engines.com/en/ranking
  ```

  

### 2.介绍和安装MySQL

**mysql的分支**

```sh
Oracle
Percona 
Mariadb
RDS
TX
```

**MySQL企业版本选择**

```sh
5.7 : 5.7.28+   每次加2
8.0 : 8.0.18+   每次加2   
实际选择 GA 6-12月版本,GA15-20版本以上的.
```

**软件获取**：

```sh
https://downloads.mysql.com/archives/community/
```

**安装 MySQL8.0.20**

1.上传解压，做好软连接

2.编写环境变量

```sh
在最后面添加一行
export PATH=/解压的路径/bin:$PATH
source /etc/profile
```

3.mysql -V

4.卸载无用的软件

```sh
yum remove -y mariadb
```

5.创建用户，以及目录，并授权

```sh
useradd mysql -s /sbin/nologin
mkdir /data/3306/data
chown -R mysql. /data
```

6.准备配置文件

```sh
vim /etc/my.cnf
[mysqld]
user=mysql
basedir=/usr/local/mysql
datadir=/data/3306/data
socket=/tmp/mysql.sock
[mysql]
socket=/tmp/mysql.sock
```

7.初始化MySQL系统数据

```sh
yum install -y libaio-devel  #安装必须的依赖
mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/data/3306/data   #初始化
正确输出：
2020-12-14T10:27:26.083747Z 0 [System] [MY-013169] [Server] /opt/mysql-8.0.20-linux-glibc2.12-x86_64/bin/mysqld (mysqld 8.0.20) initializing of server in progress as process 2205
2020-12-14T10:27:26.176690Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.
2020-12-14T10:27:31.329930Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.
2020-12-14T10:27:34.098237Z 6 [Warning] [MY-010453] [Server] root@localhost is created with an empty password ! Please consider switching off the --initialize-insecure option.
```

8.启动

```sh
[root@db01 /usr/local/mysql/support-files]# ./mysql.server start
systemctl 启动
cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld
[root@db01 /usr/local/mysql/support-files]# ./mysql.server stop
[root@db01 ~]# systemctl start mysqld
mysql 进入
```



### 3.MySQL体系结构和基础管理

**1.1 MySQL C/S工作模型**
Server : mysqld  
Client : mysql ,mysqldump ,开发工具(sqlyog  navicat workbench),API

**1.2 MySQL 实例** 
公司: boss + 经理 + 员工 + 办公区
实例: mysqld + master thread + 工作线程 + 预分配的内存 

**1.3 mysqld程序结构**
Server层 : 连接层  SQL层 
engine层 : FS

**1.4 SQL语句的执行过程**
看图.

**1.5 MySQL物理存储结构认识**
1.5.1 宏观认识
库---> 目录          在/data/3306/data 下面
表---> xxx.ibd     在改目录里面

1.5.2 微观认识

/dev/sdb ---> mkfs.xfs /dev/sdb ----> mount /dev/sdb /data   

```
extent:区(簇),连续的64个pages,默认1M.
page  :页,默认16KB,连续4个OS block 
block :块.默认4KB,连续的8个512字节
```



**基础管理**

1.创建用户

```sh
create user wdnmd@'localhost';
8.0之后,不再支持grant一次性创建用户授权了.必须先建用户后授权.
```

2.创建用户并制定密码

```sh
create user wdnmd@'localhost' identified by '123';
```

3.创建用户制定密码并制定加密方式

```sh
create user wdnmd@'localhost' identified with mysql_native_password by '123';
```

4.白名单

```sh
用户名@后面的东西
%            所有
10.0.0.%     该网段
localhost    本地登录
```

5.查询用户

```sh
select user,host,pluginauthentication_string from mysql.user;
查询 用户名，登录方式，加密方式，加密密码
```

6.修改密码

```sh
alter user wdnmd@'localhost' identified by '123456';
```

7.修改加密方式并修改密码

```sh
alter user wdnmd@'localhost' identified with mysql_native_password by '123456';
```

8.用户加锁与解锁

```sh
alter user wdnmd@'localhost' account lock     #加锁
alter user wdnmd@'localhost' account unlock   #解锁
```

9.删除用户

```sh
drop user wdnmd@'localhost';
```

**10.权限管理**

存在哪？

user              : 全局级别
db                  : 单库级别
tables_priv   : 单表级别

```sh
查看用户有哪些权限
show grants for wdnmd@'localhost';
select * from mysql.user(db | tables_priv)\G;  
```

**赋权**

```sh
grant all on *.* to wdnmd@'localhost'                       #给该用户赋予所有表权限 。
grant select,insert on wordpress.* to wdnmd@'localhost'     #给该用户赋予查询和插入权限针对WordPress表
```

**回收权限**

```sh
revoke select on wordpress.* from wdnmd@'localhost';  #回收select权限
```



案例：数据库root密码忘记怎么办

1.停止数据库  

```sh
/etc/init.d/mysqld stop
```

2.使用 --skip-grant-tables  和 --skip-networking  参数，安全登录

```sh
mysqld_safe --skip-grant-tables --skip-networking &
为了是不用密码登录数据库和禁止使用TCP协议登录数据库
```

3.刷新权限，加载授权表

flush  privileges;

4.修改root密码

```sh
alter user root@'localhost' identified by '123';
```

5.重启回到正常模式

```sh
/etc/init.d/mysqld restart
```



11.通用关闭方式

```sh
service mysqld stop   
/etc/init.d/mysqld stop     
mysql --> shutdown 
mysqladmin shutdown 
```



