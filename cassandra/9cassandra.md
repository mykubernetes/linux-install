墓碑 tombstone
---
Cassandra删除数据是给待删除的数据打一个tombstone标记，说明该数据已经无用，但为了保证所有节点上的数据的一致性，所以不会直接去物理删除。

考虑这样的情况：复制因子为3，即3个节点上都有一个副本，删除数据时，有两个节点的副本删除成功，一个节点的副本删除失败，整个删除操作仍然被认为成功的（因为有两个节点应答成功，使用CL.QUORUM一致性）。接下来如果读发生在该节点上就会变的不明确，因为结果返回是空，还是返回数据，没有办法确定哪一种是正确的。

注意：这个问题没有完全解决，即便使用了墓碑，所以假设你的集群有删除操作的话我们还要有如下操作: Cassandra运维人员必须在每个gc_grace_seconds周期内对整个集群进行repair操作。

Repair操作
---

在gc_grace_seconds设置的时间到达之前（一般为10天的秒数），每一次查询都会将符合条件是数据（包含已删除的）都给查询出来，然后Cassandra再将有墓碑标记的数据给过滤掉，这其实浪费了大量的计算资源。

Repair对Cassandra集群是极为重要的，因为频繁的数据删除以及机器Down掉（尽管有Hinted Handoff机制）都会可能导致数据不一致（多个副本之间）。在Cassandra日常维护中，我们要例行对集群进行Repair操作，使用nodetool的Repair命令，在每个节点上都执行一遍repair操作，使数据一致。

删除墓碑
---
墓碑的宽限期结束后，Cassandra在压缩过程中会删除墓碑。

逻辑删除的宽限期由属性gc_grace_seconds设置。它的默认值是864000秒（十天）。每个表都可以有自己的属性值。

在截止时间结束时，Cassandra在执行compaction 操作的过程中墓碑将被删除。
